"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[8489],{6282:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"brokers/sqlite","title":"SQLite Adapter","description":"Stem ships a SQLite adapter in stem_sqlite that implements both the broker","source":"@site/docs/brokers/sqlite.md","sourceDirName":"brokers","slug":"/brokers/sqlite","permalink":"/stem/brokers/sqlite","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/stem/tree/main/.site/docs/docs/brokers/sqlite.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"SQLite Adapter","sidebar_label":"SQLite","sidebar_position":2,"slug":"/brokers/sqlite"}}');var r=s(4848),i=s(8453);const l={title:"SQLite Adapter",sidebar_label:"SQLite",sidebar_position:2,slug:"/brokers/sqlite"},o=void 0,a={},d=[{value:"When to use SQLite",id:"when-to-use-sqlite",level:2},{value:"Install",id:"install",level:2},{value:"Quick start (broker)",id:"quick-start-broker",level:2},{value:"Quick start (result backend)",id:"quick-start-result-backend",level:2},{value:"Configuration knobs",id:"configuration-knobs",level:2},{value:"Recommended layout (separate DB files)",id:"recommended-layout-separate-db-files",level:2},{value:"Running with native assets",id:"running-with-native-assets",level:2},{value:"Adapter limitations",id:"adapter-limitations",level:2},{value:"Examples",id:"examples",level:2}];function c(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Stem ships a SQLite adapter in ",(0,r.jsx)(n.code,{children:"stem_sqlite"})," that implements both the broker\nand result backend contracts. It is designed for local development, demo\nenvironments, and single-node deployments that want a zero-infra dependency."]}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use-sqlite",children:"When to use SQLite"}),"\n",(0,r.jsx)(n.p,{children:"Use SQLite when you:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Need a ",(0,r.jsx)(n.strong,{children:"single-process"})," or ",(0,r.jsx)(n.strong,{children:"single-host"})," deployment."]}),"\n",(0,r.jsxs)(n.li,{children:["Want a ",(0,r.jsx)(n.strong,{children:"zero-infrastructure"})," dev/test broker + backend."]}),"\n",(0,r.jsx)(n.li,{children:"Prefer a local file-backed queue for demos or smoke tests."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Avoid SQLite when you need multi-host scaling, cross-process broadcast control,\nor high-throughput workloads. Redis or Postgres are better fits in production."}),"\n",(0,r.jsx)(n.h2,{id:"install",children:"Install"}),"\n",(0,r.jsx)(n.p,{children:"Add the adapter package:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  stem_sqlite: ^0.1.1\n"})}),"\n",(0,r.jsx)(n.h2,{id:"quick-start-broker",children:"Quick start (broker)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="brokers.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/brokers.dart#brokers-sqlite',children:"Future<SqliteBroker> connectSqliteBroker() {\n  final file = File('stem_broker.sqlite');\n  return SqliteBroker.open(file);\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"quick-start-result-backend",children:"Quick start (result backend)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="persistence.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/persistence.dart#persistence-backend-sqlite',children:"Future<void> connectSqliteBackend() async {\n  final broker = await SqliteBroker.open(File('stem_broker.sqlite'));\n  final backend = await SqliteResultBackend.open(File('stem_backend.sqlite'));\n  final stem = Stem(\n    broker: broker,\n    registry: registry,\n    backend: backend,\n  );\n  await stem.enqueue('demo', args: {});\n  await backend.close();\n  await broker.close();\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-knobs",children:"Configuration knobs"}),"\n",(0,r.jsx)(n.p,{children:"SQLite adapters expose the same tuning hooks as other brokers/backends:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Broker options"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"namespace"}),": logical namespace for queue rows."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"defaultVisibilityTimeout"}),": lease duration before re-delivery."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pollInterval"}),": how often workers poll for due jobs."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sweeperInterval"}),": how often to clear expired locks."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"deadLetterRetention"}),": how long to keep dead letter rows."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Result backend options"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"namespace"}),": logical namespace for task result rows."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"defaultTtl"}),": how long task results are retained by default."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"groupDefaultTtl"}),": TTL for group/chord metadata."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"heartbeatTtl"}),": TTL for worker heartbeat rows."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cleanupInterval"}),": how frequently expired rows are cleaned up."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["These options are passed to ",(0,r.jsx)(n.code,{children:"SqliteBroker.open(...)"})," and\n",(0,r.jsx)(n.code,{children:"SqliteResultBackend.open(...)"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Migrations run automatically on first open; keep the database file on local\ndisk and allow the process to create the file if it does not exist."}),"\n",(0,r.jsx)(n.h2,{id:"recommended-layout-separate-db-files",children:"Recommended layout (separate DB files)"}),"\n",(0,r.jsxs)(n.p,{children:["SQLite uses WAL and only allows ",(0,r.jsx)(n.strong,{children:"one writer at a time"}),". To avoid lock\ncontention:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use separate DB files"})," for the broker and backend."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keep producers off the backend"})," (let workers be the only writers)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Do not share a single SQLite file"})," between broker and backend."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"A simple layout:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"./stem_broker.sqlite   # broker only\n./stem_backend.sqlite  # result backend only\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"task_context_mixed"})," example defaults to separate files and exposes:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"STEM_SQLITE_BROKER_PATH"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"STEM_SQLITE_BACKEND_PATH"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"running-with-native-assets",children:"Running with native assets"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"sqlite3"})," package uses native assets. For stable behavior, build CLI\nbundles and run the compiled binary:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd packages/stem/example/task_context_mixed\n\ndart build cli -t bin/worker.dart -o build/worker\ndart build cli -t bin/enqueue.dart -o build/enqueue\n\nbuild/worker/bundle/bin/worker\nbuild/enqueue/bundle/bin/enqueue\n"})}),"\n",(0,r.jsx)(n.h2,{id:"adapter-limitations",children:"Adapter limitations"}),"\n",(0,r.jsx)(n.p,{children:"SQLite brokers are intentionally minimal:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Broadcast fan-out is in-process only"})," (worker control commands across\nprocesses are not supported)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single-queue subscriptions only"})," (one queue per worker subscription)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Polling-based delivery"})," (latency depends on ",(0,r.jsx)(n.code,{children:"pollInterval"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single-writer constraint"})," (plan your processes and DB files accordingly)."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"If you need cross-process broadcast control, multi-queue consumption, or\nmulti-host scaling,\nuse Redis or Postgres instead."}),"\n",(0,r.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/stem/example/task_context_mixed"})," \u2013 TaskContext/TaskInvocationContext\nenqueue patterns on SQLite."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/stem/example/workflows/sqlite_store.dart"})," \u2013 workflow state stored\nin SQLite."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/stem_sqlite/example/stem_sqlite_example.dart"})," \u2013 adapter smoke test."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(6540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);