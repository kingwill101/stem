"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[5590],{6451:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"brokers/overview","title":"Broker Comparison","description":"Stem ships with multiple broker adapters and planned integrations. This page","source":"@site/docs/brokers/overview.md","sourceDirName":"brokers","slug":"/brokers","permalink":"/stem/brokers","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/stem/tree/main/.site/docs/docs/brokers/overview.md","tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"title":"Broker Comparison","sidebar_label":"Broker Overview","sidebar_position":0,"slug":"/brokers"},"sidebar":"docs","previous":{"title":"Beat Scheduler","permalink":"/stem/scheduler/beat"},"next":{"title":"Broker Caveats","permalink":"/stem/brokers/caveats"}}');var t=s(4848),i=s(8453);const a={title:"Broker Comparison",sidebar_label:"Broker Overview",sidebar_position:0,slug:"/brokers"},o=void 0,d={},l=[{value:"What is a broker?",id:"what-is-a-broker",level:2},{value:"Broker vs result backend",id:"broker-vs-result-backend",level:2},{value:"What a Stem broker must provide",id:"what-a-stem-broker-must-provide",level:2},{value:"Broker feature matrix",id:"broker-feature-matrix",level:2},{value:"Broker summaries",id:"broker-summaries",level:2},{value:"Redis Streams",id:"redis-streams",level:3},{value:"Postgres",id:"postgres",level:3},{value:"SQLite",id:"sqlite",level:3},{value:"In-memory",id:"in-memory",level:3},{value:"RabbitMQ (planned)",id:"rabbitmq-planned",level:3},{value:"Amazon SQS (planned)",id:"amazon-sqs-planned",level:3},{value:"Adapter Guidance",id:"adapter-guidance",level:3},{value:"Selecting a Broker",id:"selecting-a-broker",level:3},{value:"Broker configuration quick start",id:"broker-configuration-quick-start",level:2}];function c(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"Stem ships with multiple broker adapters and planned integrations. This page\nexplains what a broker does, how it differs from result storage, and how to\nchoose the right transport for your deployment."}),"\n",(0,t.jsx)(r.h2,{id:"what-is-a-broker",children:"What is a broker?"}),"\n",(0,t.jsxs)(r.p,{children:["A ",(0,t.jsx)(r.strong,{children:"broker"})," is the message transport between producers and workers. When you\ncall ",(0,t.jsx)(r.code,{children:"Stem.enqueue"}),", the broker persists the task envelope and makes it\navailable to one or more workers. The broker is not where results live; it only\nhandles delivery."]}),"\n",(0,t.jsx)(r.p,{children:"In Stem:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Producer \u2192 Broker"}),": publishes a task envelope."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Worker \u2190 Broker"}),": consumes and acknowledges deliveries."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Result backend"}),": stores the task result/state (separate component)."]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"broker-vs-result-backend",children:"Broker vs result backend"}),"\n",(0,t.jsxs)(r.p,{children:["Use the broker for ",(0,t.jsx)(r.strong,{children:"delivery"}),", and a result backend for ",(0,t.jsx)(r.strong,{children:"history"}),":"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Broker"}),": queues, leases, priority, delayed delivery, broadcast channels."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Result backend"}),": task status, result payloads, heartbeats, group/chord\nmetadata."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"You can mix and match (e.g. Redis broker + Postgres backend) depending on\ndurability and performance needs."}),"\n",(0,t.jsx)(r.h2,{id:"what-a-stem-broker-must-provide",children:"What a Stem broker must provide"}),"\n",(0,t.jsxs)(r.p,{children:["Every broker adapter implements the same ",(0,t.jsx)(r.code,{children:"Broker"})," contract and should support:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"At-least-once delivery"})," with acknowledgements."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Visibility/leases"})," so workers can extend or retry tasks safely."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Priority buckets"})," so higher-priority tasks are dispatched first."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Delayed tasks"})," via ",(0,t.jsx)(r.code,{children:"notBefore"})," and retry scheduling."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Broadcast channels"})," (used for worker control commands)."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"If the broker does not support a feature, it should document the limitation.\nPlanned adapters may not support full control-plane tooling until release."}),"\n",(0,t.jsx)(r.h2,{id:"broker-feature-matrix",children:"Broker feature matrix"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Broker"}),(0,t.jsx)(r.th,{children:"Status"}),(0,t.jsx)(r.th,{children:"Delivery"}),(0,t.jsx)(r.th,{children:"Delays"}),(0,t.jsx)(r.th,{children:"Priority"}),(0,t.jsx)(r.th,{children:"Broadcast/Control"}),(0,t.jsx)(r.th,{children:"Notes"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Redis Streams"}),(0,t.jsx)(r.td,{children:"\u2705 Supported"}),(0,t.jsx)(r.td,{children:"At-least-once"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"Lowest latency, great default."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Postgres"}),(0,t.jsx)(r.td,{children:"\u2705 Supported"}),(0,t.jsx)(r.td,{children:"At-least-once"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"Durable, SQL-friendly; higher latency than Redis."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"SQLite"}),(0,t.jsx)(r.td,{children:"\u2705 Supported"}),(0,t.jsx)(r.td,{children:"At-least-once"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u26a0\ufe0f"}),(0,t.jsx)(r.td,{children:"Single-host file broker; broadcast fan-out is in-process only."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"In-memory"}),(0,t.jsx)(r.td,{children:"\u2705 Supported"}),(0,t.jsx)(r.td,{children:"At-least-once"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"Single-process only; testing/dev."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"RabbitMQ"}),(0,t.jsx)(r.td,{children:"\ud83d\udd1c Planned"}),(0,t.jsx)(r.td,{children:"AMQP acks"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"Mature routing; requires AMQP infra."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Amazon SQS"}),(0,t.jsx)(r.td,{children:"\ud83d\udd1c Planned"}),(0,t.jsx)(r.td,{children:"Visibility timeout"}),(0,t.jsx)(r.td,{children:"\u2705"}),(0,t.jsx)(r.td,{children:"Limited"}),(0,t.jsx)(r.td,{children:"\u26a0\ufe0f"}),(0,t.jsx)(r.td,{children:"Fully managed; no native fanout."})]})]})]}),"\n",(0,t.jsx)(r.h2,{id:"broker-summaries",children:"Broker summaries"}),"\n",(0,t.jsx)(r.h3,{id:"redis-streams",children:"Redis Streams"}),"\n",(0,t.jsx)(r.p,{children:"Best default for most deployments: low latency, strong support for delayed\ntasks and leases, and mature operations tooling. Tune persistence (AOF or RDB)\nbased on durability needs."}),"\n",(0,t.jsx)(r.h3,{id:"postgres",children:"Postgres"}),"\n",(0,t.jsx)(r.p,{children:"A good fit when you prefer a single database dependency or want SQL visibility\ninto queue state. Slightly higher latency than Redis; use a connection pool\naligned with worker concurrency."}),"\n",(0,t.jsx)(r.h3,{id:"sqlite",children:"SQLite"}),"\n",(0,t.jsxs)(r.p,{children:["Best for single-host development and demos. The SQLite broker uses polling-\nbased delivery and supports broadcast fan-out only for subscribers in the same\nprocess. Use separate SQLite files for broker vs. backend to avoid WAL\ncontention. See the ",(0,t.jsx)(r.a,{href:"/stem/brokers/sqlite",children:"SQLite adapter guide"})," for setup and\noperational notes."]}),"\n",(0,t.jsx)(r.h3,{id:"in-memory",children:"In-memory"}),"\n",(0,t.jsx)(r.p,{children:"Perfect for tests and local demos. Not durable and only works inside a single\nprocess."}),"\n",(0,t.jsx)(r.h3,{id:"rabbitmq-planned",children:"RabbitMQ (planned)"}),"\n",(0,t.jsx)(r.p,{children:"Ideal for teams already invested in AMQP routing and tooling. Stem will map its\nqueue/broadcast model onto topic and fanout exchanges."}),"\n",(0,t.jsx)(r.h3,{id:"amazon-sqs-planned",children:"Amazon SQS (planned)"}),"\n",(0,t.jsx)(r.p,{children:"Great for managed AWS deployments and automatic scaling. Expect higher latency\nand limited fanout without SNS."}),"\n",(0,t.jsx)(r.h3,{id:"adapter-guidance",children:"Adapter Guidance"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Redis Streams"})," is the default. Enable persistence (AOF) and replicate to a\nhot standby for fault tolerance. Configure namespaces per environment with\nACLs. The ",(0,t.jsx)(r.code,{children:"examples/redis_postgres_worker"})," sample pairs Redis with Postgres\nfor result storage."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Postgres"})," integrates tightly with the existing result backend for teams\nalready running Postgres. Leases are implemented via advisory locks; ensure\nthe connection pool matches expected concurrency."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"SQLite"})," is ideal for single-host development and demos. Use separate DB\nfiles for broker and backend; avoid producer writes to the backend."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"In-memory"})," adapters mirror the Redis API and are safe for smoke tests."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"RabbitMQ & SQS"})," bindings follow the same ",(0,t.jsx)(r.code,{children:"Broker"})," contract. Keep tasks\nidempotent\u2014visibility/lease guarantees differ slightly (documented in the\nadapter guides once released)."]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"selecting-a-broker",children:"Selecting a Broker"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Start with Redis Streams unless your platform mandates a specific broker."}),"\n",(0,t.jsx)(r.li,{children:"Consider Postgres when you need transactional enqueue/dequeue or prefer a\nsingle database dependency with built-in durability."}),"\n",(0,t.jsx)(r.li,{children:"Use in-memory during development to simplify onboarding."}),"\n",(0,t.jsx)(r.li,{children:"If you already operate RabbitMQ/SQS at scale, wire the respective adapter\nand monitor the lease/ack semantics described in the spec."}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"broker-configuration-quick-start",children:"Broker configuration quick start"}),"\n",(0,t.jsx)(r.p,{children:"Set the broker URL:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"export STEM_BROKER_URL=redis://localhost:6379\n"})}),"\n",(0,t.jsx)(r.p,{children:"Then bootstrap (pass a namespace if you want logical separation per env):"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-dart",children:"final broker = await RedisStreamsBroker.connect(\n  Platform.environment['STEM_BROKER_URL']!,\n  namespace: 'stem',\n);\n"})}),"\n",(0,t.jsx)(r.p,{children:"Or use the broker snippet entrypoints:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-dart",metastring:'title="brokers.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/brokers.dart#brokers-redis',children:"Future<RedisStreamsBroker> connectRedisBroker() {\n  return RedisStreamsBroker.connect('redis://127.0.0.1:6379/0');\n}\n"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-dart",metastring:'title="brokers.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/brokers.dart#brokers-postgres',children:"Future<PostgresBroker> connectPostgresBroker() {\n  return PostgresBroker.connect('postgres://localhost:5432/stem');\n}\n"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-dart",metastring:'title="brokers.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/brokers.dart#brokers-sqlite',children:"Future<SqliteBroker> connectSqliteBroker() {\n  final file = File('stem_broker.sqlite');\n  return SqliteBroker.open(file);\n}\n"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-dart",metastring:'title="brokers.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/brokers.dart#brokers-in-memory',children:"InMemoryBroker createInMemoryBroker() {\n  return InMemoryBroker();\n}\n"})}),"\n",(0,t.jsxs)(r.p,{children:["For result storage, see the ",(0,t.jsx)(r.a,{href:"/stem/core-concepts/persistence",children:"Persistence"}),"\nguide."]}),"\n",(0,t.jsxs)(r.p,{children:["Need adapter limitations and behavior details? See\n",(0,t.jsx)(r.a,{href:"/stem/brokers/caveats",children:"Broker Caveats"}),"."]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>a,x:()=>o});var n=s(6540);const t={},i=n.createContext(t);function a(e){const r=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);