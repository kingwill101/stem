"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[4725],{1470:(e,n,t)=>{t.d(n,{A:()=>T});var s=t(6540),r=t(4164),a=t(7559),i=t(3104),o=t(6347),c=t(205),l=t(7485),d=t(1682),u=t(679);function h(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,s.useMemo)(()=>{const e=n??function(e){return h(e).map(({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s}))}(t);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function x({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(r),(0,s.useCallback)(e=>{if(!r)return;const n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})},[r,t])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,a=p(e),[i,o]=(0,s.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a})),[l,d]=x({queryString:t,groupId:r}),[h,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,r]=(0,u.Dv)(n);return[t,(0,s.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:r}),k=(()=>{const e=l??h;return m({value:e,tabValues:a})?e:null})();(0,c.A)(()=>{k&&o(k)},[k]);return{selectedValue:i,selectValue:(0,s.useCallback)(e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),g(e)},[d,g,a]),tabValues:a}}var k=t(2303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(4848);function b({className:e,block:n,selectedValue:t,selectValue:s,tabValues:a}){const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),l=e=>{const n=e.currentTarget,r=o.indexOf(n),i=a[r].value;i!==t&&(c(n),s(i))},d=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:a.map(({value:e,label:n,attributes:s})=>(0,f.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:l,...s,className:(0,r.A)("tabs__item",y.tabItem,s?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function v({lazy:e,children:n,selectedValue:t}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find(e=>e.props.value===t);return e?(0,s.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:a.map((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function j(e){const n=g(e);return(0,f.jsxs)("div",{className:(0,r.A)(a.G.tabs.container,"tabs-container",y.tabList),children:[(0,f.jsx)(b,{...n,...e}),(0,f.jsx)(v,{...n,...e})]})}function T(e){const n=(0,k.A)();return(0,f.jsx)(j,{...e,children:h(e.children)},String(n))}},7033:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"core-concepts/tasks","title":"Tasks & Retries","description":"Tasks are the units of work executed by Stem workers. Each task is represented by","source":"@site/docs/core-concepts/tasks.md","sourceDirName":"core-concepts","slug":"/core-concepts/tasks","permalink":"/stem/core-concepts/tasks","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/stem/tree/main/.site/docs/docs/core-concepts/tasks.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Tasks & Retries","sidebar_label":"Tasks","sidebar_position":1,"slug":"/core-concepts/tasks"},"sidebar":"docs","previous":{"title":"Core Concepts","permalink":"/stem/core-concepts"},"next":{"title":"Producer API","permalink":"/stem/core-concepts/producer"}}');var r=t(4848),a=t(8453),i=t(1470),o=t(9365);const c={title:"Tasks & Retries",sidebar_label:"Tasks",sidebar_position:1,slug:"/core-concepts/tasks"},l=void 0,d={},u=[{value:"Registering Handlers",id:"registering-handlers",level:2},{value:"Typed Task Definitions",id:"typed-task-definitions",level:2},{value:"Configuring Retries",id:"configuring-retries",level:2},{value:"Task Context",id:"task-context",level:2},{value:"Enqueue from a running task",id:"enqueue-from-a-running-task",level:3},{value:"Retry from a running task",id:"retry-from-a-running-task",level:3},{value:"Retry policy overrides",id:"retry-policy-overrides",level:3},{value:"Isolation &amp; Timeouts",id:"isolation--timeouts",level:2},{value:"Idempotency Checklist",id:"idempotency-checklist",level:2},{value:"Task Payload Encoders",id:"task-payload-encoders",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Tasks are the units of work executed by Stem workers. Each task is represented by\na handler registered in a ",(0,r.jsx)(n.code,{children:"TaskRegistry"}),". Handlers expose metadata through\n",(0,r.jsx)(n.code,{children:"TaskOptions"}),", which control routing, retry behavior, timeouts, and isolation."]}),"\n",(0,r.jsx)(n.h2,{id:"registering-handlers",children:"Registering Handlers"}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(o.A,{value:"in-memory",label:"In-memory (tasks/email_task.dart)",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:"file=<rootDir>/../packages/stem/example/docs_snippets/lib/tasks.dart#tasks-register-in-memory",children:"class EmailTask extends TaskHandler<void> {\n  @override\n  String get name => 'email.send';\n\n  @override\n  TaskOptions get options => const TaskOptions(maxRetries: 2);\n\n  @override\n  Future<void> call(TaskContext context, Map<String, Object?> args) async {\n    final to = args['to'] as String? ?? 'anonymous';\n    print('Emailing $to (attempt ${context.attempt})');\n  }\n}\n\nfinal registry = SimpleTaskRegistry()..register(EmailTask());\n"})})}),(0,r.jsx)(o.A,{value:"redis",label:"Redis (tasks/email_task.dart)",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:"file=<rootDir>/../packages/stem/example/docs_snippets/lib/tasks.dart#tasks-register-redis",children:"class RedisEmailTask extends TaskHandler<void> {\n  @override\n  String get name => 'email.send';\n\n  @override\n  TaskOptions get options => const TaskOptions(\n    queue: 'email',\n    maxRetries: 4,\n    visibilityTimeout: Duration(seconds: 30),\n    unique: true,\n    uniqueFor: Duration(minutes: 5),\n  );\n\n  @override\n  Future<void> call(TaskContext context, Map<String, Object?> args) async {\n    await sendEmailRemote(args);\n  }\n}\n\nfinal redisRegistry = SimpleTaskRegistry()..register(RedisEmailTask());\n"})})})]}),"\n",(0,r.jsx)(n.h2,{id:"typed-task-definitions",children:"Typed Task Definitions"}),"\n",(0,r.jsxs)(n.p,{children:["Stem ships with ",(0,r.jsx)(n.code,{children:"TaskDefinition<TArgs, TResult>"})," so producers get compile-time\nchecks for required arguments and result types. A definition bundles the task\nname, argument encoder, optional metadata, and default ",(0,r.jsx)(n.code,{children:"TaskOptions"}),". Build a\ncall with ",(0,r.jsx)(n.code,{children:".call(args)"})," or ",(0,r.jsx)(n.code,{children:"TaskEnqueueBuilder"})," and hand it to ",(0,r.jsx)(n.code,{children:"Stem.enqueueCall"}),"\nor ",(0,r.jsx)(n.code,{children:"Canvas"})," helpers:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:"file=<rootDir>/../packages/stem/example/docs_snippets/lib/tasks.dart#tasks-typed-definition",children:"class InvoicePayload {\n  const InvoicePayload({required this.invoiceId});\n  final String invoiceId;\n}\n\nclass PublishInvoiceTask extends TaskHandler<void> {\n  static final definition = TaskDefinition<InvoicePayload, bool>(\n    name: 'invoice.publish',\n    encodeArgs: (payload) => {'invoiceId': payload.invoiceId},\n    metadata: const TaskMetadata(description: 'Publishes invoices downstream'),\n    defaultOptions: const TaskOptions(queue: 'billing'),\n  );\n\n  @override\n  String get name => definition.name;\n\n  @override\n  TaskOptions get options => definition.defaultOptions;\n\n  @override\n  Future<void> call(TaskContext context, Map<String, Object?> args) async {\n    final invoiceId = args['invoiceId'] as String;\n    await publishInvoice(invoiceId);\n  }\n}\n\nFuture<void> runTypedDefinitionExample() async {\n  final broker = InMemoryBroker();\n  final backend = InMemoryResultBackend();\n  final stem = Stem(\n    broker: broker,\n    registry: SimpleTaskRegistry()..register(PublishInvoiceTask()),\n    backend: backend,\n  );\n\n  final taskId = await stem.enqueueCall(\n    PublishInvoiceTask.definition(const InvoicePayload(invoiceId: 'inv_42')),\n  );\n  final result = await stem.waitForTask<bool>(taskId);\n  if (result?.isSucceeded == true) {\n    print('Invoice published');\n  }\n  await backend.close();\n  await broker.close();\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Typed results flow through ",(0,r.jsx)(n.code,{children:"TaskResult<TResult>"})," when you call\n",(0,r.jsx)(n.code,{children:"Stem.waitForTask<TResult>"}),", ",(0,r.jsx)(n.code,{children:"Canvas.group<T>"}),", ",(0,r.jsx)(n.code,{children:"Canvas.chain<T>"}),", or\n",(0,r.jsx)(n.code,{children:"Canvas.chord<T>"}),". Supplying a custom ",(0,r.jsx)(n.code,{children:"decode"})," callback on the task signature\nlets you deserialize complex objects before they reach application code."]}),"\n",(0,r.jsx)(n.h2,{id:"configuring-retries",children:"Configuring Retries"}),"\n",(0,r.jsxs)(n.p,{children:["Workers apply an ",(0,r.jsx)(n.code,{children:"ExponentialJitterRetryStrategy"})," by default. Each retry is\nscheduled by publishing a new envelope with an updated ",(0,r.jsx)(n.code,{children:"notBefore"}),". Control\nretry cadence by:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Setting ",(0,r.jsx)(n.code,{children:"TaskOptions.maxRetries"})," (initial attempt + ",(0,r.jsx)(n.code,{children:"maxRetries"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Supplying a custom ",(0,r.jsx)(n.code,{children:"RetryStrategy"})," to the worker."]}),"\n",(0,r.jsxs)(n.li,{children:["Tuning the broker connection (e.g. Redis ",(0,r.jsx)(n.code,{children:"blockTime"}),", ",(0,r.jsx)(n.code,{children:"claimInterval"}),",\n",(0,r.jsx)(n.code,{children:"defaultVisibilityTimeout"}),") so delayed messages are drained quickly."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)(n.code,{children:"examples/retry_task"})," Compose demo for a runnable setup that prints\nevery retry signal and shows how the strategy interacts with broker timings."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="lib/retry_backoff.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/retry_backoff.dart#retry-backoff-strategy',children:"final RetryStrategy retryStrategy = ExponentialJitterRetryStrategy(\n  base: const Duration(milliseconds: 200),\n  max: const Duration(seconds: 2),\n);\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="lib/retry_backoff.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/retry_backoff.dart#retry-backoff-worker',children:"  final workerConfig = StemWorkerConfig(retryStrategy: retryStrategy);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"task-context",children:"Task Context"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"TaskContext"})," provides metadata and control helpers:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"context.attempt"})," \u2013 current attempt number (0-based)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"context.heartbeat()"})," \u2013 extend the lease to avoid timeouts."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"context.extendLease(Duration by)"})," \u2013 request additional processing time."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"context.progress(percent, data: {...})"})," \u2013 emit progress signals for UI hooks."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Use the context to build idempotent handlers. Re-enqueue work, cancel jobs, or\nstore audit details in ",(0,r.jsx)(n.code,{children:"context.meta"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)(n.code,{children:"example/task_context_mixed"})," demo for a runnable sample that exercises\ninline + isolate enqueue, TaskRetryPolicy overrides, and enqueue options.\nThe ",(0,r.jsx)(n.code,{children:"example/task_usage_patterns.dart"})," sample shows in-memory TaskContext and\nTaskInvocationContext patterns without external dependencies."]}),"\n",(0,r.jsx)(n.h3,{id:"enqueue-from-a-running-task",children:"Enqueue from a running task"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"TaskContext.enqueue"}),"/",(0,r.jsx)(n.code,{children:"spawn"})," to schedule follow-up work with the same\ndefaults as ",(0,r.jsx)(n.code,{children:"Stem.enqueue"}),". For isolate entrypoints, ",(0,r.jsx)(n.code,{children:"TaskInvocationContext"}),"\nexposes the same API plus the fluent builder."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:"file=<rootDir>/../packages/stem/example/docs_snippets/lib/tasks.dart#tasks-context-enqueue",children:"Future<void> enqueueFromContext(TaskContext context) async {\n  await context.enqueue(\n    'tasks.child',\n    args: {'id': '123'},\n    enqueueOptions: TaskEnqueueOptions(\n      countdown: const Duration(seconds: 30),\n      queue: 'critical',\n      retry: true,\n      retryPolicy: const TaskRetryPolicy(\n        backoff: true,\n        defaultDelay: Duration(seconds: 2),\n        maxRetries: 5,\n      ),\n    ),\n  );\n\n  // Alias for enqueue.\n  await context.spawn('tasks.child', args: {'id': '456'});\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Inside isolate entrypoints:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:"file=<rootDir>/../packages/stem/example/docs_snippets/lib/tasks.dart#tasks-invocation-builder",children:"Future<void> enqueueWithBuilder(TaskInvocationContext invocation) async {\n  final call = invocation\n      .enqueueBuilder(\n        definition: childDefinition,\n        args: const ChildArgs('value'),\n      )\n      .queue('critical')\n      .priority(9)\n      .delay(const Duration(seconds: 5))\n      .enqueueOptions(\n        const TaskEnqueueOptions(\n          retry: true,\n          retryPolicy: TaskRetryPolicy(\n            backoff: true,\n            defaultDelay: Duration(seconds: 1),\n          ),\n        ),\n      )\n      .build();\n\n  await invocation.enqueueCall(call);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"retry-from-a-running-task",children:"Retry from a running task"}),"\n",(0,r.jsx)(n.p,{children:"Handlers can request a retry directly from the context:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"await context.retry(countdown: const Duration(seconds: 10));\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Retries respect ",(0,r.jsx)(n.code,{children:"TaskOptions.retryPolicy"})," unless you override it with\n",(0,r.jsx)(n.code,{children:"TaskEnqueueOptions.retryPolicy"})," or ",(0,r.jsx)(n.code,{children:"context.retry(retryPolicy: ...)"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"retry-policy-overrides",children:"Retry policy overrides"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"TaskRetryPolicy"})," captures backoff controls and can be applied per handler or\nper enqueue:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"final options = TaskOptions(\n  maxRetries: 3,\n  retryPolicy: TaskRetryPolicy(\n    backoff: true,\n    defaultDelay: const Duration(seconds: 1),\n    backoffMax: const Duration(seconds: 30),\n  ),\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"isolation--timeouts",children:"Isolation & Timeouts"}),"\n",(0,r.jsx)(n.p,{children:"Set soft/hard timeouts to guard against runaway tasks:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:"file=<rootDir>/../packages/stem/example/docs_snippets/lib/tasks.dart#tasks-timeouts",children:"const emailTimeoutOptions = TaskOptions(\n  softTimeLimit: Duration(seconds: 15),\n  hardTimeLimit: Duration(seconds: 30),\n  acksLate: true,\n);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Soft timeouts"})," trigger ",(0,r.jsx)(n.code,{children:"WorkerEventType.timeout"})," so you can log or notify."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hard timeouts"})," raise ",(0,r.jsx)(n.code,{children:"TimeoutException"})," to force retries or failure."]}),"\n",(0,r.jsxs)(n.li,{children:["Provide an ",(0,r.jsx)(n.code,{children:"isolateEntrypoint"})," to run the task in a dedicated isolate when\nenforcing hard limits or dealing with CPU-intensive code."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"idempotency-checklist",children:"Idempotency Checklist"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Make task inputs explicit (",(0,r.jsx)(n.code,{children:"args"}),", ",(0,r.jsx)(n.code,{children:"headers"}),", ",(0,r.jsx)(n.code,{children:"meta"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Guard external calls with idempotency keys."}),"\n",(0,r.jsx)(n.li,{children:"Store state transitions atomically (e.g. using Postgres or Redis transactions)."}),"\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.code,{children:"TaskOptions.unique"}),"/",(0,r.jsx)(n.code,{children:"uniqueFor"})," for naturally unique jobs (see\n",(0,r.jsx)(n.a,{href:"/stem/core-concepts/uniqueness",children:"Uniqueness"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"TaskOptions.rateLimit"})," with a worker ",(0,r.jsx)(n.code,{children:"RateLimiter"})," to throttle hot tasks\n(see ",(0,r.jsx)(n.a,{href:"/stem/core-concepts/rate-limiting",children:"Rate Limiting"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["With these practices in place, tasks can be retried safely and composed via\nchains, groups, and chords (see ",(0,r.jsx)(n.a,{href:"/stem/core-concepts/canvas",children:"Canvas Patterns"}),")."]}),"\n",(0,r.jsx)(n.h2,{id:"task-payload-encoders",children:"Task Payload Encoders"}),"\n",(0,r.jsxs)(n.p,{children:["Handlers often need to encrypt, compress, or otherwise transform arguments and\nresults before they leave the process. Stem exposes ",(0,r.jsx)(n.code,{children:"TaskPayloadEncoder"})," so you\ncan swap out the default JSON pass-through behavior:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="Encoders/global.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/tasks.dart#tasks-encoders-global',children:"class Base64PayloadEncoder extends TaskPayloadEncoder {\n  const Base64PayloadEncoder();\n\n  @override\n  Object? encode(Object? value) =>\n      value is String ? base64Encode(utf8.encode(value)) : value;\n\n  @override\n  Object? decode(Object? stored) =>\n      stored is String ? utf8.decode(base64Decode(stored)) : stored;\n}\n\nFuture<void> configureEncoders() async {\n  final app = await StemApp.inMemory(\n    tasks: [EmailTask()],\n    argsEncoder: const Base64PayloadEncoder(),\n    resultEncoder: const Base64PayloadEncoder(),\n    additionalEncoders: const [MyOtherEncoder()],\n  );\n  await app.close();\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Workers automatically decode arguments once (",(0,r.jsx)(n.code,{children:"stem-args-encoder"})," header /\n",(0,r.jsx)(n.code,{children:"__stemArgsEncoder"})," meta) and encode results once (",(0,r.jsx)(n.code,{children:"__stemResultEncoder"})," meta)\nbefore writing to the backend. When you need task-specific behavior, set the\nmetadata overrides:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:"file=<rootDir>/../packages/stem/example/docs_snippets/lib/tasks.dart#tasks-encoders-metadata",children:"class EncodedTask extends TaskHandler<void> {\n  @override\n  String get name => 'encoded.task';\n\n  @override\n  TaskMetadata get metadata => const TaskMetadata(\n    argsEncoder: Base64PayloadEncoder(),\n    resultEncoder: Base64PayloadEncoder(),\n  );\n\n  @override\n  TaskOptions get options => const TaskOptions();\n\n  @override\n  Future<void> call(TaskContext context, Map<String, Object?> args) async {}\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Because encoders are centrally registered inside the\n",(0,r.jsx)(n.code,{children:"TaskPayloadEncoderRegistry"}),", every producer/worker instance that shares the\nregistry can resolve encoder ids reliably\u2014even across processes or languages."]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(6540);const r={},a=s.createContext(r);function i(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:n},e.children)}},9365:(e,n,t)=>{t.d(n,{A:()=>i});t(6540);var s=t(4164);const r={tabItem:"tabItem_Ymn6"};var a=t(4848);function i({children:e,hidden:n,className:t}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(r.tabItem,t),hidden:n,children:e})}}}]);