"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[1684],{7823:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>d,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"scheduler/index","title":"Scheduler","description":"Stem Beat coordinates periodic work across your cluster. Explore the scheduler","source":"@site/docs/scheduler/index.md","sourceDirName":"scheduler","slug":"/scheduler","permalink":"/stem/scheduler","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/stem/tree/main/.site/docs/docs/scheduler/index.md","tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"title":"Scheduler","slug":"/scheduler","sidebar_position":0},"sidebar":"docs","previous":{"title":"Daemonization","permalink":"/stem/workers/daemonization"},"next":{"title":"Beat Scheduler","permalink":"/stem/scheduler/beat"}}');var r=n(4848),l=n(8453);const d={title:"Scheduler",slug:"/scheduler",sidebar_position:0},i=void 0,o={},c=[{value:"What Beat does",id:"what-beat-does",level:2},{value:"Schedule spec types",id:"schedule-spec-types",level:2},{value:"Beat in production",id:"beat-in-production",level:2},{value:"HA and lock stores",id:"ha-and-lock-stores",level:2},{value:"Schedule stores",id:"schedule-stores",level:2},{value:"CLI entrypoints",id:"cli-entrypoints",level:2},{value:"Scheduler snippets",id:"scheduler-snippets",level:2}];function a(e){const s={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"Stem Beat coordinates periodic work across your cluster. Explore the scheduler\ncapabilities, storage backends, and operational tooling."}),"\n",(0,r.jsx)(s.h2,{id:"what-beat-does",children:"What Beat does"}),"\n",(0,r.jsx)(s.p,{children:"Beat reads schedule definitions from a schedule store, evaluates when each entry\nis due, and enqueues the corresponding task. Use it for cron-style jobs,\ninterval tasks, solar events, or one-off clocked runs."}),"\n",(0,r.jsx)(s.h2,{id:"schedule-spec-types",children:"Schedule spec types"}),"\n",(0,r.jsx)(s.p,{children:"Stem ships concrete spec types you can store or generate:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Interval"})," (",(0,r.jsx)(s.code,{children:"IntervalScheduleSpec"}),") \u2014 run every N seconds/minutes/hours."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Cron"})," (",(0,r.jsx)(s.code,{children:"CronScheduleSpec"}),") \u2014 standard cron expressions."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Solar"})," (",(0,r.jsx)(s.code,{children:"SolarScheduleSpec"}),") \u2014 sunrise/sunset-based schedules."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Clocked"})," (",(0,r.jsx)(s.code,{children:"ClockedScheduleSpec"}),") \u2014 single run at a specific time."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"beat-in-production",children:"Beat in production"}),"\n",(0,r.jsx)(s.p,{children:"Beat is a separate process from workers. It only enqueues tasks; workers still\nexecute them. That separation means you can scale Beat (and its schedule store)\nindependently from worker fleets."}),"\n",(0,r.jsx)(s.h2,{id:"ha-and-lock-stores",children:"HA and lock stores"}),"\n",(0,r.jsx)(s.p,{children:"To run Beat in high availability mode, multiple Beat instances can share the\nsame schedule store and a lock store. The lock store ensures only one scheduler\nemits a given schedule entry at a time. Redis and Postgres stores support this\npattern out of the box."}),"\n",(0,r.jsx)(s.h2,{id:"schedule-stores",children:"Schedule stores"}),"\n",(0,r.jsxs)(s.p,{children:["Beat persists schedule entries so restarts do not lose state. For production,\nuse a shared schedule store (Redis/Postgres) and a lock store to coordinate HA\ninstances. The CLI schedule commands use ",(0,r.jsx)(s.code,{children:"STEM_SCHEDULE_STORE_URL"})," when set;\notherwise they operate on local schedule files."]}),"\n",(0,r.jsx)(s.h2,{id:"cli-entrypoints",children:"CLI entrypoints"}),"\n",(0,r.jsx)(s.p,{children:"Common scheduler CLI commands:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"stem schedule apply"})," \u2014 load schedule entries from JSON/YAML into the store."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"stem schedule list"})," \u2014 inspect entries in the store."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"stem schedule dry-run"})," \u2014 preview due times before rollout."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"stem observe schedules"})," \u2014 inspect schedule drift and dispatch status."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"scheduler-snippets",children:"Scheduler snippets"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",metastring:'title="Interval schedule" file=<rootDir>/../packages/stem/example/docs_snippets/lib/scheduler.dart#beat-interval-spec',children:"Future<void> addIntervalSchedule(ScheduleStore store) async {\n  await store.upsert(\n    ScheduleEntry(\n      id: 'interval-demo',\n      taskName: 'demo.interval',\n      queue: 'default',\n      spec: IntervalScheduleSpec(\n        every: const Duration(minutes: 10),\n      ),\n      jitter: const Duration(minutes: 1),\n    ),\n  );\n}\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",metastring:'title="Cron schedule" file=<rootDir>/../packages/stem/example/docs_snippets/lib/scheduler.dart#beat-cron-spec',children:"Future<void> addCronSchedule(ScheduleStore store) async {\n  await store.upsert(\n    ScheduleEntry(\n      id: 'cron-demo',\n      taskName: 'demo.cron',\n      queue: 'default',\n      spec: CronScheduleSpec(expression: '0 12 * * MON'),\n    ),\n  );\n}\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",metastring:'title="Solar schedule" file=<rootDir>/../packages/stem/example/docs_snippets/lib/scheduler.dart#beat-solar-spec',children:"Future<void> addSolarSchedule(ScheduleStore store) async {\n  await store.upsert(\n    ScheduleEntry(\n      id: 'solar-demo',\n      taskName: 'demo.solar',\n      queue: 'default',\n      spec: SolarScheduleSpec(\n        event: 'sunrise',\n        latitude: 51.5072,\n        longitude: -0.1276,\n        offset: const Duration(minutes: 30),\n      ),\n    ),\n  );\n}\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",metastring:'title="Clocked schedule" file=<rootDir>/../packages/stem/example/docs_snippets/lib/scheduler.dart#beat-clocked-spec',children:"Future<void> addClockedSchedule(ScheduleStore store) async {\n  final runAt = DateTime.now().add(const Duration(hours: 6));\n  await store.upsert(\n    ScheduleEntry(\n      id: 'clocked-demo',\n      taskName: 'demo.clocked',\n      queue: 'default',\n      spec: ClockedScheduleSpec(runAt: runAt),\n    ),\n  );\n}\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",metastring:'title="Scheduler signals" file=<rootDir>/../packages/stem/example/docs_snippets/lib/scheduler.dart#beat-signals',children:"void registerBeatSignals() {\n  StemSignals.scheduleEntryDue.connect((payload, _) {\n    print('[due] ${payload.entry.id} @ ${payload.tickAt}');\n  });\n\n  StemSignals.scheduleEntryDispatched.connect((payload, _) {\n    print('[dispatched] drift=${payload.drift.inMilliseconds}ms');\n  });\n\n  StemSignals.scheduleEntryFailed.connect((payload, _) {\n    print('[failed] ${payload.entry.id}: ${payload.error}');\n  });\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:"Beat itself runs as a Dart process; see the Beat guide for entrypoints."}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"/stem/scheduler/beat",children:"Beat Scheduler Guide"})})," \u2013 Configure Beat, load schedules, and run it with in-memory, Redis, or Postgres stores."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Example:"})," ",(0,r.jsx)(s.code,{children:"example/scheduler_observability"})," shows drift metrics, schedule signals, and CLI inspection."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Looking for locking and storage details? See the Postgres and Redis sections in\n",(0,r.jsx)(s.a,{href:"/stem/brokers",children:"Broker Overview"}),"."]})]})}function u(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>i});var t=n(6540);const r={},l=t.createContext(r);function d(e){const s=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(l.Provider,{value:s},e.children)}}}]);