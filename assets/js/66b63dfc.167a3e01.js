"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[5083],{1470:(e,t,n)=>{n.d(t,{A:()=>T});var r=n(6540),a=n(4164),s=n(7559),i=n(3104),l=n(6347),o=n(205),c=n(7485),d=n(1682),u=n(679);function p(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function g(e){const{values:t,children:n}=e;return(0,r.useMemo)(()=>{const e=t??function(e){return p(e).map(({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r}))}(n);return function(e){const t=(0,d.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,n])}function h({value:e,tabValues:t}){return t.some(t=>t.value===e)}function m({queryString:e=!1,groupId:t}){const n=(0,l.W6)(),a=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(a),(0,r.useCallback)(e=>{if(!a)return;const t=new URLSearchParams(n.location.search);t.set(a,e),n.replace({...n.location,search:t.toString()})},[a,n])]}function b(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,s=g(e),[i,l]=(0,r.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find(e=>e.default)??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:s})),[c,d]=m({queryString:n,groupId:a}),[p,b]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,a]=(0,u.Dv)(t);return[n,(0,r.useCallback)(e=>{t&&a.set(e)},[t,a])]}({groupId:a}),f=(()=>{const e=c??p;return h({value:e,tabValues:s})?e:null})();(0,o.A)(()=>{f&&l(f)},[f]);return{selectedValue:i,selectValue:(0,r.useCallback)(e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),b(e)},[d,b,s]),tabValues:s}}var f=n(2303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var k=n(4848);function v({className:e,block:t,selectedValue:n,selectValue:r,tabValues:s}){const l=[],{blockElementScrollPositionUntilNextRender:o}=(0,i.a_)(),c=e=>{const t=e.currentTarget,a=l.indexOf(t),i=s[a].value;i!==n&&(o(t),r(i))},d=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,k.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},e),children:s.map(({value:e,label:t,attributes:r})=>(0,k.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...r,className:(0,a.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function y({lazy:e,children:t,selectedValue:n}){const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===n);return e?(0,r.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,k.jsx)("div",{className:"margin-top--md",children:s.map((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function j(e){const t=b(e);return(0,k.jsxs)("div",{className:(0,a.A)(s.G.tabs.container,"tabs-container",x.tabList),children:[(0,k.jsx)(v,{...t,...e}),(0,k.jsx)(y,{...t,...e})]})}function T(e){const t=(0,f.A)();return(0,k.jsx)(j,{...e,children:p(e.children)},String(t))}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>l});var r=n(6540);const a={},s=r.createContext(a);function i(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(s.Provider,{value:t},e.children)}},9292:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>g,frontMatter:()=>o,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"getting-started/best-practices","title":"Best Practices","description":"These guidelines help keep task systems reliable and observable as you scale.","source":"@site/docs/getting-started/best-practices.md","sourceDirName":"getting-started","slug":"/getting-started/best-practices","permalink":"/stem/getting-started/best-practices","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/stem/tree/main/.site/docs/docs/getting-started/best-practices.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"title":"Best Practices","sidebar_label":"Best Practices","sidebar_position":9,"slug":"/getting-started/best-practices"},"sidebar":"docs","previous":{"title":"Next Steps","permalink":"/stem/getting-started/next-steps"},"next":{"title":"Reliability","permalink":"/stem/getting-started/reliability"}}');var a=n(4848),s=n(8453),i=n(1470),l=n(9365);const o={title:"Best Practices",sidebar_label:"Best Practices",sidebar_position:9,slug:"/getting-started/best-practices"},c=void 0,d={},u=[{value:"Task design",id:"task-design",level:2},{value:"Error handling",id:"error-handling",level:2},{value:"Concurrency &amp; load",id:"concurrency--load",level:2},{value:"Observability",id:"observability",level:2},{value:"Operations",id:"operations",level:2},{value:"Terminology clarity",id:"terminology-clarity",level:2},{value:"Next steps",id:"next-steps",level:2}];function p(e){const t={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"These guidelines help keep task systems reliable and observable as you scale.\nThey are framework-agnostic and apply directly to Stem."}),"\n",(0,a.jsx)(t.h2,{id:"task-design",children:"Task design"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Keep task arguments small and serializable."}),"\n",(0,a.jsx)(t.li,{children:"Store large payloads in object storage and pass references instead."}),"\n",(0,a.jsx)(t.li,{children:"Make tasks idempotent; assume retries can happen."}),"\n",(0,a.jsx)(t.li,{children:"Wrap enqueue + state changes in a transaction or outbox pattern when\ninteracting with databases."}),"\n",(0,a.jsx)(t.li,{children:"Prefer deterministic task names and queues for routing clarity."}),"\n",(0,a.jsx)(t.li,{children:"Surface structured metadata for tracing and auditing."}),"\n"]}),"\n",(0,a.jsxs)(i.A,{children:[(0,a.jsx)(l.A,{value:"task",label:"Define a task",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",metastring:'title="lib/best_practices.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/best_practices.dart#best-practices-task',children:"class IdempotentTask extends TaskHandler<void> {\n  @override\n  String get name => 'orders.sync';\n\n  @override\n  TaskOptions get options => const TaskOptions(maxRetries: 3);\n\n  @override\n  TaskMetadata get metadata => const TaskMetadata(idempotent: true);\n\n  @override\n  Future<void> call(TaskContext context, Map<String, Object?> args) async {\n    final orderId = args['orderId'] as String? ?? 'unknown';\n    print('Sync order $orderId');\n  }\n}\n"})})}),(0,a.jsx)(l.A,{value:"enqueue",label:"Typed enqueue",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",metastring:'title="lib/best_practices.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/best_practices.dart#best-practices-enqueue',children:"Future<void> enqueueTyped(Stem stem) async {\n  await stem.enqueue(\n    'orders.sync',\n    args: {'orderId': 'order-42'},\n    meta: {'requestId': 'req-001'},\n  );\n}\n"})})})]}),"\n",(0,a.jsx)(t.h2,{id:"error-handling",children:"Error handling"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Treat transient failures as retryable; use explicit backoff policies."}),"\n",(0,a.jsx)(t.li,{children:"Fail fast on validation errors to avoid wasted retries."}),"\n",(0,a.jsx)(t.li,{children:"Send poison-pill tasks to a DLQ and fix root causes before replaying."}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",metastring:'title="lib/workers_programmatic.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/workers_programmatic.dart#workers-worker-retry',children:"class FlakyTask extends TaskHandler<void> {\n  @override\n  String get name => 'demo.flaky';\n\n  @override\n  TaskOptions get options => const TaskOptions(maxRetries: 2);\n\n  @override\n  Future<void> call(TaskContext context, Map<String, Object?> args) async {\n    if (context.attempt < 2) {\n      throw StateError('Simulated failure');\n    }\n    print('Succeeded on attempt ${context.attempt}');\n  }\n}\n\nFuture<void> retryWorker() async {\n  StemSignals.taskRetry.connect((payload, _) {\n    print('[retry] next run at: ${payload.nextRetryAt}');\n  });\n\n  final registry = SimpleTaskRegistry()..register(FlakyTask());\n  final worker = Worker(\n    broker: InMemoryBroker(),\n    registry: registry,\n    backend: InMemoryResultBackend(),\n    retryStrategy: ExponentialJitterRetryStrategy(\n      base: const Duration(milliseconds: 200),\n      max: const Duration(seconds: 1),\n    ),\n  );\n\n  await worker.start();\n}\n"})}),"\n",(0,a.jsx)(t.h2,{id:"concurrency--load",children:"Concurrency & load"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Start with conservative concurrency and scale up with metrics."}),"\n",(0,a.jsx)(t.li,{children:"Embrace concurrency by running more worker processes instead of single\nhot loops."}),"\n",(0,a.jsx)(t.li,{children:"Use rate limits for hot handlers or fragile downstreams."}),"\n",(0,a.jsx)(t.li,{children:"Avoid long-running inline loops without heartbeats or progress signals."}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",metastring:'title="lib/rate_limiting.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/rate_limiting.dart#rate-limit-task',children:"// #region rate-limit-task-options\nclass RateLimitedTask extends TaskHandler<void> {\n  @override\n  String get name => 'demo.rateLimited';\n\n  @override\n  TaskOptions get options => const TaskOptions(\n    rateLimit: '10/s',\n    maxRetries: 3,\n  );\n\n  @override\n  Future<void> call(TaskContext context, Map<String, Object?> args) async {\n    final actor = args['actor'] as String? ?? 'anonymous';\n    print('Handled rate-limited task for $actor');\n  }\n}\n// #endregion rate-limit-task-options\n"})}),"\n",(0,a.jsx)(t.h2,{id:"observability",children:"Observability"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Emit lifecycle signals early so you can build dashboards from day one."}),"\n",(0,a.jsx)(t.li,{children:"Track queue depth, retry rates, and DLQ volume as leading indicators."}),"\n",(0,a.jsx)(t.li,{children:"Correlate task IDs with business logs for easier incident response."}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",metastring:'title="lib/signals.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/signals.dart#signals-configure',children:"void configureSignals() {\n  StemSignals.configure(\n    configuration: const StemSignalConfiguration(\n      enabled: true,\n      enabledSignals: {'worker-heartbeat': false},\n    ),\n  );\n}\n"})}),"\n",(0,a.jsx)(t.h2,{id:"operations",children:"Operations"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Separate environments with namespaces and credentials."}),"\n",(0,a.jsx)(t.li,{children:"Bake health checks into deploy pipelines."}),"\n",(0,a.jsx)(t.li,{children:"Automate rotation of signing keys and TLS certificates."}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",metastring:'title="lib/production_checklist.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/production_checklist.dart#production-signing-config',children:"Future<void> configureSigning() async {\n  final config = StemConfig.fromEnvironment();\n"})}),"\n",(0,a.jsx)(t.h2,{id:"terminology-clarity",children:"Terminology clarity"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Task"}),": a unit of work executed by a worker."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Queue"}),": the channel tasks are routed through."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Worker"}),": the process that consumes tasks and executes handlers."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Backend"}),": the store for task results and group state."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"/stem/getting-started/observability-and-ops",children:"Observability & Ops"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"/stem/getting-started/production-checklist",children:"Production Checklist"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"/stem/core-concepts/tasks",children:"Tasks & Retries"})}),"\n"]})]})}function g(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},9365:(e,t,n)=>{n.d(t,{A:()=>i});n(6540);var r=n(4164);const a={tabItem:"tabItem_Ymn6"};var s=n(4848);function i({children:e,hidden:t,className:n}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(a.tabItem,n),hidden:t,children:e})}}}]);