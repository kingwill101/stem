"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[4537],{1470:(e,n,s)=>{s.d(n,{A:()=>w});var r=s(6540),t=s(4164),i=s(7559),a=s(3104),l=s(6347),o=s(205),c=s(7485),d=s(1682),u=s(679);function h(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m(e){const{values:n,children:s}=e;return(0,r.useMemo)(()=>{const e=n??function(e){return h(e).map(({props:{value:e,label:n,attributes:s,default:r}})=>({value:e,label:n,attributes:s,default:r}))}(s);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,s])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function g({queryString:e=!1,groupId:n}){const s=(0,l.W6)(),t=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(t),(0,r.useCallback)(e=>{if(!t)return;const n=new URLSearchParams(s.location.search);n.set(t,e),s.replace({...s.location,search:n.toString()})},[t,s])]}function b(e){const{defaultValue:n,queryString:s=!1,groupId:t}=e,i=m(e),[a,l]=(0,r.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=n.find(e=>e.default)??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:i})),[c,d]=g({queryString:s,groupId:t}),[h,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,t]=(0,u.Dv)(n);return[s,(0,r.useCallback)(e=>{n&&t.set(e)},[n,t])]}({groupId:t}),k=(()=>{const e=c??h;return p({value:e,tabValues:i})?e:null})();(0,o.A)(()=>{k&&l(k)},[k]);return{selectedValue:a,selectValue:(0,r.useCallback)(e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),b(e)},[d,b,i]),tabValues:i}}var k=s(2303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=s(4848);function j({className:e,block:n,selectedValue:s,selectValue:r,tabValues:i}){const l=[],{blockElementScrollPositionUntilNextRender:o}=(0,a.a_)(),c=e=>{const n=e.currentTarget,t=l.indexOf(n),a=i[t].value;a!==s&&(o(n),r(a))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const s=l.indexOf(e.currentTarget)+1;n=l[s]??l[0];break}case"ArrowLeft":{const s=l.indexOf(e.currentTarget)-1;n=l[s]??l[l.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":n},e),children:i.map(({value:e,label:n,attributes:r})=>(0,x.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...r,className:(0,t.A)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":s===e}),children:n??e},e))})}function y({lazy:e,children:n,selectedValue:s}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===s);return e?(0,r.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==s}))})}function v(e){const n=b(e);return(0,x.jsxs)("div",{className:(0,t.A)(i.G.tabs.container,"tabs-container",f.tabList),children:[(0,x.jsx)(j,{...n,...e}),(0,x.jsx)(y,{...n,...e})]})}function w(e){const n=(0,k.A)();return(0,x.jsx)(v,{...e,children:h(e.children)},String(n))}},4745:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"getting-started/troubleshooting","title":"Troubleshooting","description":"Common issues when getting started with Stem and how to resolve them.","source":"@site/docs/getting-started/troubleshooting.md","sourceDirName":"getting-started","slug":"/getting-started/troubleshooting","permalink":"/stem/getting-started/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/stem/tree/main/.site/docs/docs/getting-started/troubleshooting.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Troubleshooting","sidebar_label":"Troubleshooting","sidebar_position":7,"slug":"/getting-started/troubleshooting"},"sidebar":"docs","previous":{"title":"Production Checklist","permalink":"/stem/getting-started/production-checklist"},"next":{"title":"Next Steps","permalink":"/stem/getting-started/next-steps"}}');var t=s(4848),i=s(8453),a=s(1470),l=s(9365);const o={title:"Troubleshooting",sidebar_label:"Troubleshooting",sidebar_position:7,slug:"/getting-started/troubleshooting"},c=void 0,d={},u=[{value:"Worker starts but no tasks are processed",id:"worker-starts-but-no-tasks-are-processed",level:2},{value:"Routing file fails to parse",id:"routing-file-fails-to-parse",level:2},{value:"Missing or misconfigured result backend",id:"missing-or-misconfigured-result-backend",level:2},{value:"TLS or signing failures",id:"tls-or-signing-failures",level:2},{value:"Namespace mismatch",id:"namespace-mismatch",level:2},{value:"Migrations or schema errors",id:"migrations-or-schema-errors",level:2},{value:"DLQ stalls or poison-pill tasks",id:"dlq-stalls-or-poison-pill-tasks",level:2},{value:"Control commands return no replies",id:"control-commands-return-no-replies",level:2},{value:"Task retries instantly or too quickly",id:"task-retries-instantly-or-too-quickly",level:2},{value:"Connection refused",id:"connection-refused",level:2},{value:"Still stuck?",id:"still-stuck",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Common issues when getting started with Stem and how to resolve them."}),"\n",(0,t.jsx)(n.h2,{id:"worker-starts-but-no-tasks-are-processed",children:"Worker starts but no tasks are processed"}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Make sure the producer and worker share the same broker URL."}),"\n",(0,t.jsx)(n.li,{children:"Confirm the worker is subscribed to the queue you are enqueueing into."}),"\n",(0,t.jsx)(n.li,{children:"If routing is enabled, verify the routing file and default queue."}),"\n"]}),"\n",(0,t.jsxs)(a.A,{children:[(0,t.jsx)(l.A,{value:"task",label:"Minimal task handler",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/troubleshooting.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/troubleshooting.dart#troubleshooting-task',children:"class EchoTask extends TaskHandler<String> {\n  @override\n  String get name => 'debug.echo';\n\n  @override\n  TaskOptions get options => const TaskOptions(queue: 'default');\n\n  @override\n  Future<String> call(TaskContext context, Map<String, Object?> args) async {\n    final message = args['message'] as String? ?? 'hello';\n    print('echo: $message');\n    return message;\n  }\n}\n"})})}),(0,t.jsx)(l.A,{value:"bootstrap",label:"Worker + broker bootstrap",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/troubleshooting.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/troubleshooting.dart#troubleshooting-bootstrap',children:"  final app = await StemApp.inMemory(\n    tasks: [EchoTask()],\n    workerConfig: const StemWorkerConfig(\n      queue: 'default',\n      consumerName: 'troubleshooting-worker',\n      concurrency: 1,\n    ),\n  );\n  unawaited(app.start());\n"})})}),(0,t.jsx)(l.A,{value:"enqueue",label:"Producer enqueue",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/troubleshooting.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/troubleshooting.dart#troubleshooting-enqueue',children:"  final taskId = await app.stem.enqueue(\n    'debug.echo',\n    args: {'message': 'troubleshooting'},\n  );\n"})})}),(0,t.jsx)(l.A,{value:"results",label:"Read results from the backend",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/troubleshooting.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/troubleshooting.dart#troubleshooting-results',children:"  await Future<void>.delayed(const Duration(milliseconds: 200));\n  final result = await app.backend.get(taskId);\n  print('Result: ${result?.payload}');\n"})})})]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"stem worker stats --json\nstem worker inspect\nstem observe queues\n"})}),"\n",(0,t.jsx)(n.h2,{id:"routing-file-fails-to-parse",children:"Routing file fails to parse"}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Validate the routing file path and format (YAML/JSON)."}),"\n",(0,t.jsxs)(n.li,{children:["Confirm ",(0,t.jsx)(n.code,{children:"STEM_ROUTING_CONFIG"})," points at the file you expect."]}),"\n",(0,t.jsx)(n.li,{children:"Confirm the registry matches the task names referenced in the file."}),"\n",(0,t.jsx)(n.li,{children:"If you use queue priorities, ensure the broker supports them."}),"\n"]}),"\n",(0,t.jsxs)(a.A,{children:[(0,t.jsx)(l.A,{value:"load",label:"Load routing file",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/routing.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/routing.dart#routing-load',children:"Future<RoutingRegistry> loadRouting() async {\n  final source = await File('config/routing.yaml').readAsString();\n  return RoutingRegistry.fromYaml(source);\n}\n\nfinal registry = RoutingRegistry(\n  RoutingConfig(\n    defaultQueue: const DefaultQueueConfig(alias: 'default', queue: 'primary'),\n    queues: {'primary': QueueDefinition(name: 'primary')},\n    routes: [\n      RouteDefinition(\n        match: RouteMatch.fromJson(const {'task': 'reports.*'}),\n        target: RouteTarget(type: 'queue', name: 'primary'),\n      ),\n    ],\n  ),\n);\n"})})}),(0,t.jsx)(l.A,{value:"inline",label:"Inline routing registry",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/routing.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/routing.dart#routing-inline',children:"final inlineRegistry = RoutingRegistry(\n  RoutingConfig(\n    defaultQueue: const DefaultQueueConfig(alias: 'default', queue: 'primary'),\n    queues: {'primary': QueueDefinition(name: 'primary')},\n    routes: [\n      RouteDefinition(\n        match: RouteMatch.fromJson(const {'task': 'reports.*'}),\n        target: RouteTarget(type: 'queue', name: 'primary'),\n      ),\n    ],\n  ),\n);\n"})})})]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"stem routing dump\nstem routing dump --json\nstem routing dump --sample\n"})}),"\n",(0,t.jsx)(n.h2,{id:"missing-or-misconfigured-result-backend",children:"Missing or misconfigured result backend"}),"\n",(0,t.jsxs)(n.p,{children:["Symptoms: ",(0,t.jsx)(n.code,{children:"stem observe"})," fails or task results never appear."]}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Set ",(0,t.jsx)(n.code,{children:"STEM_RESULT_BACKEND_URL"})," for any workflow that needs stored results."]}),"\n",(0,t.jsxs)(n.li,{children:["Ensure the backend URL uses the correct scheme (",(0,t.jsx)(n.code,{children:"redis://"}),", ",(0,t.jsx)(n.code,{children:"postgres://"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Confirm the worker is configured with the same result backend."}),"\n"]}),"\n",(0,t.jsxs)(a.A,{children:[(0,t.jsx)(l.A,{value:"redis",label:"Redis result backend",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/persistence.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/persistence.dart#persistence-backend-redis',children:"Future<void> connectRedisBackend() async {\n  final backend = await RedisResultBackend.connect('redis://localhost:6379/1');\n  final broker = await RedisStreamsBroker.connect('redis://localhost:6379');\n  final stem = Stem(\n    broker: broker,\n    registry: registry,\n    backend: backend,\n  );\n  await stem.enqueue('demo', args: {});\n  await backend.close();\n  await broker.close();\n}\n"})})}),(0,t.jsx)(l.A,{value:"postgres",label:"Postgres result backend",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/persistence.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/persistence.dart#persistence-backend-postgres',children:"Future<void> connectPostgresBackend() async {\n  final backend = await PostgresResultBackend.connect(\n    connectionString: 'postgres://postgres:postgres@localhost:5432/stem',\n  );\n  final broker = await RedisStreamsBroker.connect('redis://localhost:6379');\n  final stem = Stem(\n    broker: broker,\n    registry: registry,\n    backend: backend,\n  );\n  await stem.enqueue('demo', args: {});\n  await backend.close();\n  await broker.close();\n}\n"})})})]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'stem health --backend "$STEM_RESULT_BACKEND_URL"\nstem observe workers\nstem observe queues\n'})}),"\n",(0,t.jsx)(n.h2,{id:"tls-or-signing-failures",children:"TLS or signing failures"}),"\n",(0,t.jsx)(n.p,{children:"Symptoms: health checks fail or tasks land in the DLQ with signature errors."}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Verify ",(0,t.jsx)(n.code,{children:"STEM_TLS_*"})," variables are set on every component that connects."]}),"\n",(0,t.jsxs)(n.li,{children:["Confirm ",(0,t.jsx)(n.code,{children:"STEM_SIGNING_KEYS"}),"/",(0,t.jsx)(n.code,{children:"STEM_SIGNING_PUBLIC_KEYS"})," match across producers and workers."]}),"\n",(0,t.jsxs)(n.li,{children:["Ensure ",(0,t.jsx)(n.code,{children:"STEM_SIGNING_ACTIVE_KEY"})," is set and present in the key list."]}),"\n",(0,t.jsxs)(n.li,{children:["Check DLQ entries for ",(0,t.jsx)(n.code,{children:"signature-invalid"})," reasons."]}),"\n"]}),"\n",(0,t.jsxs)(a.A,{children:[(0,t.jsx)(l.A,{value:"signed",label:"Signed enqueue",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/producer.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/producer.dart#producer-signed',children:"Future<void> enqueueWithSigning() async {\n  final config = StemConfig.fromEnvironment();\n  final broker = await RedisStreamsBroker.connect(\n    config.brokerUrl,\n    tls: config.tls,\n  );\n  final backend = InMemoryResultBackend();\n  final registry = SimpleTaskRegistry()\n    ..register(\n      FunctionTaskHandler<void>(\n        name: 'billing.charge',\n        entrypoint: (context, args) async {\n          final customerId = args['customerId'] as String? ?? 'unknown';\n          print('Queued charge for $customerId');\n          return null;\n        },\n      ),\n    );\n  final stem = Stem(\n    broker: broker,\n    registry: registry,\n    backend: backend,\n    signer: PayloadSigner.maybe(config.signing),\n  );\n\n  await stem.enqueue(\n    'billing.charge',\n    args: {'customerId': 'cust_123', 'amount': 4200},\n    notBefore: DateTime.now().add(const Duration(minutes: 5)),\n  );\n  await backend.close();\n  await broker.close();\n}\n"})})}),(0,t.jsx)(l.A,{value:"shared-signer",label:"Shared signer config",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/production_checklist.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/production_checklist.dart#production-signing-config',children:"Future<void> configureSigning() async {\n  final config = StemConfig.fromEnvironment();\n"})})}),(0,t.jsx)(l.A,{value:"runtime",label:"Stem + worker signing setup",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/production_checklist.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/production_checklist.dart#production-signing-runtime',children:"  // #region production-signing-stem\n  final stem = Stem(\n    broker: broker,\n    backend: backend,\n    registry: registry,\n    signer: signer,\n  );\n  // #endregion production-signing-stem\n\n  // #region production-signing-worker\n  final worker = Worker(\n    broker: broker,\n    backend: backend,\n    registry: registry,\n    signer: signer,\n  );\n  // #endregion production-signing-worker\n"})})})]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'stem health \\\n  --broker "$STEM_BROKER_URL" \\\n  --backend "$STEM_RESULT_BACKEND_URL"\n\nstem dlq list --queue <queue>\nstem dlq show --queue <queue> --id <task-id>\n'})}),"\n",(0,t.jsx)(n.h2,{id:"namespace-mismatch",children:"Namespace mismatch"}),"\n",(0,t.jsx)(n.p,{children:"Symptoms: CLI sees no data or control commands return empty responses."}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ensure all processes (producer, worker, CLI) use the same namespace string."}),"\n",(0,t.jsxs)(n.li,{children:["For workers, confirm ",(0,t.jsx)(n.code,{children:"STEM_WORKER_NAMESPACE"})," matches your CLI ",(0,t.jsx)(n.code,{children:"--namespace"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(a.A,{children:[(0,t.jsx)(l.A,{value:"broker",label:"Broker + backend namespace",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/namespaces.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/namespaces.dart#namespaces-broker-backend',children:"Future<void> configureNamespace() async {\n  final broker = await RedisStreamsBroker.connect(\n    'redis://localhost:6379/0',\n    namespace: 'prod-us-east',\n  );\n  final backend = await RedisResultBackend.connect(\n    'redis://localhost:6379/1',\n    namespace: 'prod-us-east',\n  );\n\n  await broker.close();\n  await backend.close();\n}\n"})})}),(0,t.jsx)(l.A,{value:"worker",label:"Worker namespace",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/namespaces.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/namespaces.dart#namespaces-worker',children:"Future<void> configureWorkerNamespace() async {\n  final registry = SimpleTaskRegistry();\n  final broker = InMemoryBroker(namespace: 'prod-us-east');\n  final backend = InMemoryResultBackend();\n\n  final worker = Worker(\n    broker: broker,\n    registry: registry,\n    backend: backend,\n    heartbeatNamespace: 'prod-us-east',\n  );\n\n  await worker.shutdown();\n  await backend.close();\n  await broker.close();\n}\n"})})})]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'stem worker stats --namespace "stem"\nstem worker ping --namespace "stem"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"migrations-or-schema-errors",children:"Migrations or schema errors"}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Run the migration commands shipped with the adapter (Redis/Postgres)."}),"\n",(0,t.jsx)(n.li,{children:"Ensure your store URLs point to the migrated database/schema."}),"\n",(0,t.jsxs)(n.li,{children:["Set ",(0,t.jsx)(n.code,{children:"STEM_SCHEDULE_STORE_URL"})," before running schedule commands."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"stem schedule list\n"})}),"\n",(0,t.jsx)(n.h2,{id:"dlq-stalls-or-poison-pill-tasks",children:"DLQ stalls or poison-pill tasks"}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Inspect DLQ entries and replay only after fixing the root cause."}),"\n",(0,t.jsx)(n.li,{children:"For repeat failures, consider lowering retries or adding task-level guards."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"stem dlq list --queue <queue>\nstem dlq show --queue <queue> --id <task-id>\nstem dlq replay --queue <queue> --id <task-id>\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example enqueue that will land in the DLQ:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="bin/producer.dart" file=<rootDir>/../packages/stem/example/dlq_sandbox/bin/producer.dart#dlq-producer-enqueue',children:"  for (final invoice in invoices) {\n    final id = await stem.enqueue(\n      taskName(),\n      args: {\n        'invoiceId': invoice,\n      },\n      meta: {\n        'createdAt': DateTime.now().toIso8601String(),\n      },\n      options: const TaskOptions(\n        queue: 'default',\n        maxRetries: 2,\n      ),\n    );\n    stdout.writeln('[producer] queued invoice=$invoice taskId=$id');\n  }\n"})}),"\n",(0,t.jsx)(n.h2,{id:"control-commands-return-no-replies",children:"Control commands return no replies"}),"\n",(0,t.jsx)(n.p,{children:"This usually means the control broadcast channel is not being consumed."}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ensure the worker is running and connected to the same broker."}),"\n",(0,t.jsxs)(n.li,{children:["If you use a custom namespace, pass ",(0,t.jsx)(n.code,{children:"--namespace"})," to CLI commands."]}),"\n",(0,t.jsx)(n.li,{children:"Verify that the broker supports broadcast/control channels."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"stem worker stats --json\nstem observe workers\n"})}),"\n",(0,t.jsx)(n.h2,{id:"task-retries-instantly-or-too-quickly",children:"Task retries instantly or too quickly"}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Confirm your task\u2019s ",(0,t.jsx)(n.code,{children:"TaskOptions"})," (",(0,t.jsx)(n.code,{children:"maxRetries"}),", ",(0,t.jsx)(n.code,{children:"visibilityTimeout"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Ensure the broker supports delayed deliveries (",(0,t.jsx)(n.code,{children:"notBefore"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Check broker clock drift if delays feel inconsistent."}),"\n"]}),"\n",(0,t.jsxs)(a.A,{children:[(0,t.jsx)(l.A,{value:"task-options",label:"Retry-related task options",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/retry_backoff.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/retry_backoff.dart#retry-backoff-task-options',children:"  @override\n  TaskOptions get options => const TaskOptions(maxRetries: 2);\n"})})}),(0,t.jsx)(l.A,{value:"strategy",label:"Jittered retry strategy",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",metastring:'title="lib/retry_backoff.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/retry_backoff.dart#retry-backoff-strategy',children:"final RetryStrategy retryStrategy = ExponentialJitterRetryStrategy(\n  base: const Duration(milliseconds: 200),\n  max: const Duration(seconds: 2),\n);\n"})})})]}),"\n",(0,t.jsx)(n.h2,{id:"connection-refused",children:"Connection refused"}),"\n",(0,t.jsx)(n.p,{children:"Checklist:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verify Redis/Postgres is running and reachable."}),"\n",(0,t.jsxs)(n.li,{children:["Confirm the URL scheme (",(0,t.jsx)(n.code,{children:"redis://"}),", ",(0,t.jsx)(n.code,{children:"postgres://"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Ensure Docker ports are mapped (",(0,t.jsx)(n.code,{children:"-p 6379:6379"}),", ",(0,t.jsx)(n.code,{children:"-p 5432:5432"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Helpful commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'stem health \\\n  --broker "$STEM_BROKER_URL" \\\n  --backend "$STEM_RESULT_BACKEND_URL" \\\n'})}),"\n",(0,t.jsx)(n.h2,{id:"still-stuck",children:"Still stuck?"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Review the ",(0,t.jsx)(n.a,{href:"/stem/getting-started/observability-and-ops",children:"Observability & Ops"})," guide for\nheartbeats, DLQ inspection, and control commands."]}),"\n",(0,t.jsxs)(n.li,{children:["Check the runnable examples under ",(0,t.jsx)(n.code,{children:"packages/stem/example/"}),"."]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var r=s(6540);const t={},i=r.createContext(t);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:n},e.children)}},9365:(e,n,s)=>{s.d(n,{A:()=>a});s(6540);var r=s(4164);const t={tabItem:"tabItem_Ymn6"};var i=s(4848);function a({children:e,hidden:n,className:s}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(t.tabItem,s),hidden:n,children:e})}}}]);