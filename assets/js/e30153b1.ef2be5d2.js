"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[6565],{6911:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"core-concepts/dashboard","title":"Dashboard","description":"Stem ships an experimental Hotwire + Routed dashboard that surfaces live queue,","source":"@site/docs/core-concepts/dashboard.md","sourceDirName":"core-concepts","slug":"/core-concepts/dashboard","permalink":"/stem/core-concepts/dashboard","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/stem/tree/main/.site/docs/docs/core-concepts/dashboard.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Dashboard","sidebar_label":"Dashboard","sidebar_position":8,"slug":"/core-concepts/dashboard"},"sidebar":"docs","previous":{"title":"Observability","permalink":"/stem/core-concepts/observability"},"next":{"title":"Persistence","permalink":"/stem/core-concepts/persistence"}}');var d=n(4848),t=n(8453);const o={title:"Dashboard",sidebar_label:"Dashboard",sidebar_position:8,slug:"/core-concepts/dashboard"},i=void 0,l={},c=[{value:"Quick start (local)",id:"quick-start-local",level:2},{value:"Environment variables",id:"environment-variables",level:2},{value:"Deployment &amp; auth guidance",id:"deployment--auth-guidance",level:2},{value:"Reverse proxy notes",id:"reverse-proxy-notes",level:2},{value:"What you can do",id:"what-you-can-do",level:2},{value:"Required dependencies (local dev)",id:"required-dependencies-local-dev",level:2},{value:"Troubleshooting: \u201cNo data\u201d",id:"troubleshooting-no-data",level:2},{value:"Diagnostics",id:"diagnostics",level:2},{value:"Notes",id:"notes",level:2}];function a(e){const s={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.p,{children:"Stem ships an experimental Hotwire + Routed dashboard that surfaces live queue,\ntask, event, and worker data. It connects through the same broker/result-backend\ncontracts as your workers, so Redis, Postgres, and in-memory deployments all\nwork without code changes."}),"\n",(0,d.jsx)(s.h2,{id:"quick-start-local",children:"Quick start (local)"}),"\n",(0,d.jsxs)(s.ol,{children:["\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:["Ensure the routed ecosystem checkout lives alongside this repo (the\ndashboard overrides ",(0,d.jsx)(s.code,{children:"routed"}),", ",(0,d.jsx)(s.code,{children:"routed_hotwire"}),", and related packages to\n",(0,d.jsx)(s.code,{children:"../routed_ecosystem"})," relative to ",(0,d.jsx)(s.code,{children:"packages/dashboard"}),").\nIf you do not have the routed workspace available, ",(0,d.jsx)(s.code,{children:"dart pub get"})," in\n",(0,d.jsx)(s.code,{children:"packages/dashboard"})," will fail because of the local dependency overrides."]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsx)(s.p,{children:"Install dependencies:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"dart pub get\ncd dashboard\ndart pub get\n"})}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsx)(s.p,{children:"Start the server:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"dart run bin/dashboard.dart\n"})}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:["Visit ",(0,d.jsx)(s.code,{children:"http://127.0.0.1:3080/"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"environment-variables",children:"Environment variables"}),"\n",(0,d.jsxs)(s.p,{children:["The dashboard reuses ",(0,d.jsx)(s.code,{children:"StemConfig"}),", so it accepts the same environment settings\nas workers and the CLI:"]}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Variable"}),(0,d.jsx)(s.th,{children:"Purpose"}),(0,d.jsx)(s.th,{children:"Default"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"STEM_BROKER_URL"})}),(0,d.jsx)(s.td,{children:"Broker URL"}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"redis://127.0.0.1:6379/0"})})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"STEM_RESULT_BACKEND_URL"})}),(0,d.jsx)(s.td,{children:"Result backend URL"}),(0,d.jsx)(s.td,{children:"broker URL"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsxs)(s.td,{children:[(0,d.jsx)(s.code,{children:"STEM_NAMESPACE"})," / ",(0,d.jsx)(s.code,{children:"STEM_DASHBOARD_NAMESPACE"})]}),(0,d.jsx)(s.td,{children:"Namespace"}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"stem"})})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"STEM_TLS_*"})}),(0,d.jsx)(s.td,{children:"TLS configuration"}),(0,d.jsx)(s.td,{children:"unset"})]})]})]}),"\n",(0,d.jsxs)(s.p,{children:["Supported schemes include ",(0,d.jsx)(s.code,{children:"redis://"}),", ",(0,d.jsx)(s.code,{children:"rediss://"}),", ",(0,d.jsx)(s.code,{children:"postgres://"}),",\n",(0,d.jsx)(s.code,{children:"postgresql://"}),", and ",(0,d.jsx)(s.code,{children:"memory://"}),"."]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-dart",metastring:'title="lib/dashboard.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/dashboard.dart#dashboard-config',children:"  final config = StemConfig.fromEnvironment({\n    'STEM_BROKER_URL': 'redis://127.0.0.1:6379/0',\n    'STEM_RESULT_BACKEND_URL': 'redis://127.0.0.1:6379/1',\n  });\n\n  stdout.writeln(\n    'Dashboard config broker=${config.brokerUrl} '\n    'backend=${config.resultBackendUrl ?? config.brokerUrl}',\n  );\n"})}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-dart",metastring:'title="lib/dashboard.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/dashboard.dart#dashboard-overrides',children:"  final config = StemConfig.fromEnvironment({\n    'STEM_BROKER_URL': 'redis://127.0.0.1:6379/0',\n    'STEM_RESULT_BACKEND_URL': 'redis://127.0.0.1:6379/1',\n    'STEM_DEFAULT_QUEUE': 'critical',\n    'STEM_PREFETCH_MULTIPLIER': '4',\n  });\n\n  stdout.writeln(\n    'Dashboard defaults queue=${config.defaultQueue} '\n    'prefetch=${config.prefetchMultiplier}',\n  );\n"})}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-dart",metastring:'title="lib/dashboard.dart" file=<rootDir>/../packages/stem/example/docs_snippets/lib/dashboard.dart#dashboard-tls',children:"  final config = StemConfig.fromEnvironment({\n    'STEM_BROKER_URL': 'rediss://redis.example.com:6380/0',\n    'STEM_TLS_CA_CERT': '/etc/ssl/certs/ca.pem',\n    'STEM_TLS_ALLOW_INSECURE': 'false',\n  });\n\n  stdout.writeln(\n    'Dashboard TLS enabled=${config.tls.isEnabled} '\n    'allowInsecure=${config.tls.allowInsecure}',\n  );\n"})}),"\n",(0,d.jsx)(s.h2,{id:"deployment--auth-guidance",children:"Deployment & auth guidance"}),"\n",(0,d.jsx)(s.p,{children:"The dashboard does not ship with its own auth layer yet. For anything beyond\nlocal use, place it behind your standard perimeter controls:"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Reverse proxy + auth"}),": run behind Nginx/Envoy/Traefik with SSO, basic auth,\nor IP allowlists."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Private network"}),": expose the dashboard only inside a VPN/VPC."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"TLS termination"}),": terminate HTTPS at the proxy and forward to\n",(0,d.jsx)(s.code,{children:"http://127.0.0.1:3080"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Audit controls"}),": restrict who can issue control commands from the UI."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"reverse-proxy-notes",children:"Reverse proxy notes"}),"\n",(0,d.jsx)(s.p,{children:"When deploying behind a proxy, ensure the proxy forwards:"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"Host"})," (or set ",(0,d.jsx)(s.code,{children:"X-Forwarded-Host"}),")"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"X-Forwarded-Proto"})," (so URLs and redirects stay correct)"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"X-Forwarded-For"})," (for request logging)"]}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:"If you mount the dashboard at a subpath, configure the proxy to rewrite to the\napp root and to pass websocket/Turbo stream upgrades."}),"\n",(0,d.jsx)(s.h2,{id:"what-you-can-do",children:"What you can do"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Overview"}),": queue + worker cards and busiest queues table."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Tasks"}),": sortable queue listings, filters, row expansion, and ad-hoc enqueue."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Events"}),": live stream of queue/worker deltas over Turbo Streams."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Workers"}),": heartbeat freshness, isolate counts, queue assignments, and\ncontrol actions (ping, soft shutdown, hard shutdown)."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Queue recovery"}),": replay dead letters per queue."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"required-dependencies-local-dev",children:"Required dependencies (local dev)"}),"\n",(0,d.jsxs)(s.p,{children:["The dashboard depends on local ",(0,d.jsx)(s.code,{children:"routed"})," ecosystem overrides:"]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"routed"}),", ",(0,d.jsx)(s.code,{children:"routed_hotwire"})]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"server_testing"}),", ",(0,d.jsx)(s.code,{children:"routed_testing"}),", ",(0,d.jsx)(s.code,{children:"property_testing"})]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"third_party/dartastic_opentelemetry_sdk"})," stub (keeps tests passing)"]}),"\n"]}),"\n",(0,d.jsxs)(s.p,{children:["Make sure the ",(0,d.jsx)(s.code,{children:"../routed_ecosystem"})," checkout exists relative to\n",(0,d.jsx)(s.code,{children:"packages/dashboard"})," before running ",(0,d.jsx)(s.code,{children:"dart pub get"}),"."]}),"\n",(0,d.jsx)(s.h2,{id:"troubleshooting-no-data",children:"Troubleshooting: \u201cNo data\u201d"}),"\n",(0,d.jsx)(s.p,{children:"If the UI loads but queues/workers are empty:"}),"\n",(0,d.jsxs)(s.ol,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Broker URL"}),": confirm ",(0,d.jsx)(s.code,{children:"STEM_BROKER_URL"})," points at the broker you expect."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Namespace"}),": verify ",(0,d.jsx)(s.code,{children:"STEM_NAMESPACE"})," / ",(0,d.jsx)(s.code,{children:"STEM_DASHBOARD_NAMESPACE"})," matches\nyour worker namespace."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Result backend"}),": set ",(0,d.jsx)(s.code,{children:"STEM_RESULT_BACKEND_URL"})," explicitly if it differs\nfrom the broker (worker heartbeats live there)."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Redis permissions"}),": for Redis, the dashboard scans ",(0,d.jsx)(s.code,{children:"stem:stream:*"})," and\nreads ",(0,d.jsx)(s.code,{children:"stem:worker:heartbeat"})," keys. ACLs must permit ",(0,d.jsx)(s.code,{children:"SCAN"}),", ",(0,d.jsx)(s.code,{children:"XLEN"}),",\n",(0,d.jsx)(s.code,{children:"XPENDING"}),", ",(0,d.jsx)(s.code,{children:"ZCARD"}),", and ",(0,d.jsx)(s.code,{children:"GET"})," on those keys."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"TLS"}),": when using ",(0,d.jsx)(s.code,{children:"rediss://"}),", make sure ",(0,d.jsx)(s.code,{children:"STEM_TLS_*"})," variables are set."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Workers online"}),": confirm workers are running and emitting heartbeats;\nif ",(0,d.jsx)(s.code,{children:"stem worker stats --json"})," shows no heartbeats, the dashboard will too."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"diagnostics",children:"Diagnostics"}),"\n",(0,d.jsx)(s.p,{children:"Use the CLI to confirm what the dashboard should show:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:'stem health \\\n  --broker "$STEM_BROKER_URL" \\\n  --backend "$STEM_RESULT_BACKEND_URL"\n\nstem worker stats --json\nstem observe queues\n'})}),"\n",(0,d.jsx)(s.h2,{id:"notes",children:"Notes"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"The Events page currently synthesizes deltas from polling. Wiring Stem's\nsignal bus will replace this with true lifecycle events."}),"\n",(0,d.jsxs)(s.li,{children:["The dashboard uses the same control plane as ",(0,d.jsx)(s.code,{children:"stem worker"})," (control queues +\ncommand replies), so the UI reflects real worker state."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,d.jsx)(s,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>i});var r=n(6540);const d={},t=r.createContext(d);function o(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);